{"version":3,"file":"commonHelpers.js","sources":["../src/constants.js","../src/api/pixabay.js","../src/utils.js","../src/index.js"],"sourcesContent":["export const IMG_PER_PAGE = 40;\n\nexport const PIXABAY_KEY = '40905594-bd576ff041a6f87471d33ae04';\n","import axios from 'axios';\nimport { IMG_PER_PAGE, PIXABAY_KEY } from '../constants';\n\nexport const fetchImages = async (searchText, page) => {\n  const response = await axios.get('https://pixabay.com/api/', {\n    params: {\n      key: PIXABAY_KEY,\n      q: searchText,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      page: page,\n      per_page: IMG_PER_PAGE,\n    },\n  });\n  return response.data;\n};\n","export const show = elem => {\n  elem.classList.remove('hidden');\n};\n\nexport const hide = elem => {\n  elem.classList.add('hidden');\n};\n","import 'normalize.css';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport iziToast from 'izitoast';\nimport { fetchImages } from './api/pixabay';\nimport { hide, show } from './utils';\nimport { IMG_PER_PAGE } from './constants';\n\niziToast.settings({\n  timeout: 5000,\n  position: 'topRight',\n});\n\nconst formElem = document.getElementById('search-form');\nconst searchInputElem = formElem.querySelector('input[name=\"searchQuery\"]');\nconst submitBtnElem = formElem.querySelector('button[type=\"submit\"]');\nconst galleryContainerElem = document.querySelector('.gallery');\nconst loadMoreBtnElem = document.querySelector('.load-more');\nconst loadMoreEndElem = document.querySelector('.load-more-end');\n\nsubmitBtnElem.addEventListener('click', runSearch);\nloadMoreBtnElem.addEventListener('click', loadMore);\n\nlet isRequestInProgress = false;\nlet page = 1;\n\nasync function runSearch(e) {\n  e.preventDefault();\n\n  if (isRequestInProgress) {\n    return;\n  }\n\n  const searchText = searchInputElem.value.trim();\n  if (!searchText) {\n    return;\n  }\n\n  let data;\n  page = 1;\n  isRequestInProgress = true;\n  submitBtnElem.disabled = true;\n  galleryContainerElem.innerHTML = '';\n  hide(loadMoreBtnElem);\n  hide(loadMoreEndElem);\n\n  try {\n    console.log('Fetching images', searchText, page);\n    data = await fetchImages(searchText, page);\n  } catch (err) {\n    console.error('Request to pixabay failed with error', err);\n    iziToast.error({\n      title: 'Request to pixabay failed with error',\n      message: err.message,\n    });\n\n    return;\n  } finally {\n    isRequestInProgress = false;\n    submitBtnElem.disabled = false;\n  }\n\n  console.log('response from pixabay', data);\n\n  if (!data.total) {\n    iziToast.warning({\n      message:\n        'Sorry, there are no images matching your search query. Please try again.',\n    });\n    return;\n  }\n\n  iziToast.success({\n    message: `Hooray! We found ${data.total} images.`,\n  });\n\n  galleryContainerElem.innerHTML = createCardsMarkup(data.hits);\n\n  if (data.totalHits > page * IMG_PER_PAGE) {\n    show(loadMoreBtnElem);\n  }\n}\n\nasync function loadMore() {\n  if (isRequestInProgress) {\n    return;\n  }\n\n  hide(loadMoreBtnElem);\n  submitBtnElem.disabled = true;\n\n  const searchText = searchInputElem.value.trim();\n\n  let data;\n  try {\n    console.log('Loading more images', searchText, page + 1);\n    isRequestInProgress = true;\n    data = await fetchImages(searchText, page + 1);\n  } catch (err) {\n    console.error('Request to pixabay failed with error', err);\n    iziToast.error({\n      title: 'Request to pixabay failed with error',\n      message: err.message,\n    });\n    show(loadMoreBtnElem);\n\n    return;\n  } finally {\n    submitBtnElem.disabled = false;\n    isRequestInProgress = false;\n  }\n\n  console.log('response from pixabay load more', data);\n\n  page++;\n  handleLoadMore(data.totalHits, page);\n\n  if (!data.hits) {\n    return;\n  }\n\n  galleryContainerElem.insertAdjacentHTML(\n    'beforeend',\n    createCardsMarkup(data.hits)\n  );\n}\n\nconst createCardsMarkup = hits => {\n  const cards = [];\n  for (const img of hits) {\n    cards.push(`\n      <div class=\"photo-card\">\n        <img src=\"${img.previewURL}\" alt=\"${img.tags}\" loading=\"lazy\" width=\"250\" height=\"150\" />\n        <div class=\"info\">\n            <p class=\"info-item\">\n              <b>Likes</b>\n              <span>${img.likes}</span>\n            </p>\n            <p class=\"info-item\">\n              <b>Views</b>\n              <span>${img.views}</span>\n            </p>\n            <p class=\"info-item\">\n              <b>Comments</b>\n              <span>${img.comments}</span>\n            </p>\n            <p class=\"info-item\">\n              <b>Downloads</b>\n              <span>${img.downloads}</span>\n            </p>\n        </div>\n      </div>\n  `);\n  }\n\n  return cards.join('');\n};\n\nconst handleLoadMore = (totalHits, page) => {\n  if (totalHits > page * IMG_PER_PAGE) {\n    show(loadMoreBtnElem);\n  } else {\n    show(loadMoreEndElem);\n  }\n};\n"],"names":["IMG_PER_PAGE","PIXABAY_KEY","fetchImages","searchText","page","axios","show","elem","hide","iziToast","formElem","searchInputElem","submitBtnElem","galleryContainerElem","loadMoreBtnElem","loadMoreEndElem","runSearch","loadMore","isRequestInProgress","e","data","err","createCardsMarkup","handleLoadMore","hits","cards","img","totalHits"],"mappings":"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"}